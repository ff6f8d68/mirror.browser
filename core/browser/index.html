<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirror Browser</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }

        .browser {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background-color: #333;
            color: #fff;
            padding: 10px;
            position: relative;
        }

        .url-bar {
            display: flex;
            align-items: center;
            padding: 5px;
        }

        .url-bar button {
            background: none;
            border: none;
            color: #fff;
            font-size: 16px;
            margin-right: 5px;
            cursor: pointer;
        }

        .url-bar input {
            flex: 1;
            padding: 5px;
            border: none;
            border-radius: 5px;
        }

        .url-bar button#go-button {
            background-color: #007bff;
            color: #fff;
            border-radius: 5px;
            padding: 5px 10px;
        }

        .tabs {
            display: flex;
            align-items: center;
            background-color: #444;
            padding: 5px;
            overflow-x: auto; /* Enable horizontal scrolling */
            white-space: nowrap; /* Prevent wrapping of tabs */
            box-sizing: border-box;
        }

        .tab {
            display: inline-flex; /* Make tabs inline-flex to fit in the scroll container */
            align-items: center;
            background-color: #555;
            color: #fff;
            padding: 10px;
            margin-right: 5px;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
        }

        .tab.active {
            background-color: #007bff;
        }

        .tab .close-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
            padding: 0;
        }

        .tab .close-btn:hover {
            color: #ff0000;
        }

        #new-tab-button {
            background-color: #28a745;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }

        .content {
            flex: 1;
            overflow: hidden;
        }

        .tab-content {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .settings-menu {
            position: absolute;
            top: 50px;
            right: 10px;
            background: #fff;
            color: #000;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .settings-menu.hidden {
            display: none;
        }

        .settings-menu button {
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="browser">
        <header>
            <div class="url-bar">
                <button id="back-button">&#9664;</button>
                <button id="forward-button">&#9654;</button>
                <input type="text" id="url-input" placeholder="Enter URL">
                <button id="go-button">Go</button>
                <button id="settings-button">&#9881;</button>
            </div>
            <div class="tabs">
                <!-- Home Tab -->
                <div class="tab active" data-url="/core/browser/home">
                    <span class="tab-title">Home</span>
                    <button class="close-btn" title="Close Tab">&times;</button>
                </div>
                <!-- Other Tabs -->
                <button id="new-tab-button">+</button>
            </div>
        </header>
        <div class="content">
            <div class="tab-content">
                <iframe id="browser-frame" src="https://mirror-browser.netlify.app/page/?url=https://www.google.com/webhp?igu=1" frameborder="0"></iframe>
            </div>
        </div>
        <div class="settings-menu hidden" id="settings-menu">
            <h2>Settings</h2>
            <label>
                <input type="checkbox" id="dark-mode"> Dark Mode
            </label>
            <button id="close-settings">Close</button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlInput = document.getElementById('url-input');
            const goButton = document.getElementById('go-button');
            const backButton = document.getElementById('back-button');
            const forwardButton = document.getElementById('forward-button');
            const settingsButton = document.getElementById('settings-button');
            const settingsMenu = document.getElementById('settings-menu');
            const closeSettingsButton = document.getElementById('close-settings');
            const darkModeCheckbox = document.getElementById('dark-mode');
            const newTabButton = document.getElementById('new-tab-button');
            const tabsContainer = document.querySelector('.tabs');
            const frame = document.querySelector('#browser-frame');

            // Default URL
            const defaultURL = 'https://mirror-browser.netlify.app/page/?url=https://www.google.com/webhp?igu=1';

            function createNewTab(url = defaultURL) {
                const tabCount = tabsContainer.querySelectorAll('.tab').length;
                const newTab = document.createElement('div');
                newTab.className = 'tab';
                newTab.innerHTML = `
                    <span class="tab-title">Tab ${tabCount + 1}</span>
                    <button class="close-btn" title="Close Tab">&times;</button>
                `;
                newTab.setAttribute('data-url', url);
                newTab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                    newTab.classList.add('active');
                    frame.src = url;
                    urlInput.value = url;
                });

                const closeButton = newTab.querySelector('.close-btn');
                closeButton.addEventListener('click', function(event) {
                    event.stopPropagation(); // Prevent tab click event
                    if (tabsContainer.querySelectorAll('.tab').length > 1) {
                        const isActiveTab = newTab.classList.contains('active');
                        newTab.remove();
                        if (isActiveTab) {
                            const remainingTabs = tabsContainer.querySelectorAll('.tab');
                            if (remainingTabs.length > 0) {
                                remainingTabs[0].click(); // Click the first tab if the active tab was closed
                            }
                        }
                    } else {
                        alert("You cannot close the last remaining tab.");
                    }
                });

                tabsContainer.insertBefore(newTab, newTabButton);
                newTab.click();
            }

            createNewTab();

            function prependProtocol(url) {
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    return 'https://' + url;
                }
                return url;
            }

            function navigateToUrl() {
                let url = urlInput.value.trim();
                if (url) {
                    url = prependProtocol(url);
                    const activeTab = document.querySelector('.tab.active');
                    if (activeTab) {
                        const newUrl = `https://mirror-browser.netlify.app/page/?url=${encodeURIComponent(url)}`;
                        frame.src = newUrl;
                        activeTab.setAttribute('data-url', newUrl);
                    } else {
                        frame.src = `https://mirror-browser.netlify.app/page/?url=${encodeURIComponent(url)}`;
                    }
                }
            }

            goButton.addEventListener('click', navigateToUrl);

            urlInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    navigateToUrl();
                    event.preventDefault(); // Prevent the default action to avoid form submission
                }
            });

            urlInput.addEventListener('click', function() {
                urlInput.select(); // Select all text in the input field
            });

            backButton.addEventListener('click', function() {
                document.querySelector('#browser-frame').contentWindow.history.back();
            });

            forwardButton.addEventListener('click', function() {
                document.querySelector('#browser-frame').contentWindow.history.forward();
            });

            settingsButton.addEventListener('click', function() {
                settingsMenu.classList.toggle('hidden');
            });

            closeSettingsButton.addEventListener('click', function() {
                settingsMenu.classList.add('hidden');
            });

            darkModeCheckbox.addEventListener('change', function() {
                document.body.classList.toggle('dark-mode', darkModeCheckbox.checked);
            });

            newTabButton.addEventListener('click', function() {
                createNewTab();
            });

            tabsContainer.addEventListener('click', function(event) {
                if (event.target.classList.contains('tab')) {
                    const url = event.target.getAttribute('data-url');
                    if (url) {
                        frame.src = url;
                        urlInput.value = url;
                    }
                }
            });

            frame.addEventListener('load', function() {
                const currentUrl = frame.contentWindow.location.href;
                urlInput.value = currentUrl;
                const activeTab = document.querySelector('.tab.active');
                if (activeTab) {
                    // Update the tab title using the custom parameters
                    const url = new URL(currentUrl);
                    const title = url.searchParams.get('title') || new URL(url.searchParams.get('url')).hostname;
                    const icon = url.searchParams.get('icon');

                    activeTab.querySelector('.tab-title').textContent = title;

                    // Update favicon for the active tab
                    let favicon = document.querySelector(`link[rel="icon"]`);
                    if (favicon) {
                        favicon.href = icon || '';
                    } else {
                        favicon = document.createElement('link');
                        favicon.rel = 'icon';
                        favicon.href = icon || '';
                        document.head.appendChild(favicon);
                    }
                }
            });

            function updateIframeLinks() {
                const frameDocument = frame.contentDocument || frame.contentWindow.document;
                const script = document.createElement('script');
                script.textContent = `
                    document.addEventListener('click', function(event) {
                        if (event.target.tagName === 'A' && event.target.href) {
                            event.preventDefault();
                            const url = event.target.href;
                            window.top.document.querySelector('#browser-frame').src = 'https://mirror-browser.netlify.app/page/?url=' + encodeURIComponent(url);
                        }
                    }, true);
                `;
                frameDocument.head.appendChild(script);
            }

            frame.addEventListener('load', updateIframeLinks);
        });
    </script>
</body>
</html>
